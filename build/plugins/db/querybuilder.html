
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
	<meta charset="utf-8" />
	<title>The Query Builder - Blocks Docs</title>
	<link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
	<link rel="stylesheet" href="../../_static/css/docs.css" type="text/css" />
</head>

<body>
	<div class="sidebar">
		<div class="content">
			<h1>Blocks Docs</h1>

			<nav class="nav">
				<ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Blocks Docs Home</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installing and Updating</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">System Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../templating/index.html">Templating</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Plugin Development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../basics/gettingstarted.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/templates.html">Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/resources.html">Front-end Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/i18n.html">Internationalization</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">The Query Builder</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="records.html">Active Record Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrations.html">Migrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/widgets.html">Dashboard Widgets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/blocktypes.html">Block Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/models.html">Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/controllers.html">Controllers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/services.html">Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/variables.html">Template Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/account.html">AccountService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/blockTypes.html">BlockTypesService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/config.html">ConfigService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/email.html">EmailService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/entries.html">EntriesService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/globals.html">GlobalsService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/pages.html">PagesService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/path.html">PathService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/request.html">HttpRequestService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/i18n.html">LocalizationService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/plugins.html">PluginsService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/templates.html">TemplatesService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/users.html">UsersService</a></li>
</ul>
</li>
</ul>

			</nav>
		</div>
	</div>

	<div class="main">
		<div class="content">
			
				<ul class="crumbs">
					<li><a href="../index.html">Plugin Development</a></li>
				</ul>
			

			
  <div class="section" id="the-query-builder">
<h1>The Query Builder<a class="headerlink" href="#the-query-builder" title="Permalink to this headline">¶</a></h1>
<p>Currently Blocks only support MySQL, but there’s a good chance that we’ll add support for other database engines in the future, such as SQL Server and PostgreSQL. With that in mind, it’s important that we run all SQL queries through Blocks’ query builder.</p>
<p>You can create a new query via <tt class="docutils literal"><span class="pre">blx()-&gt;db-&gt;createCommand()</span></tt>, which returns a new DbCommand instance. DbCommand is based on Yii’s <a class="reference external" href="http://www.yiiframework.com/doc/api/1.1/CDbCommand">CDbCommand</a> class (See Yii’s <a class="reference external" href="http://www.yiiframework.com/doc/guide/1.1/en/database.query-builder">Query Builder</a>  docs), with a few enhancements.</p>
<div class="section" id="dbcommand-enhancements">
<h2>DbCommand Enhancements<a class="headerlink" href="#dbcommand-enhancements" title="Permalink to this headline">¶</a></h2>
<p>DbCommand enhances CDbCommand in the following ways:</p>
<ul class="simple">
<li>Automatically add the DB table prefix to table names, without requiring you to wrap the table name in <tt class="docutils literal"><span class="pre">{{</span></tt> and <tt class="docutils literal"><span class="pre">}}</span></tt></li>
<li>Added support for specifying AND conditions as key/value arrays, e.g. <tt class="docutils literal"><span class="pre">where(array('id'</span> <span class="pre">=&gt;</span> <span class="pre">$id,</span> <span class="pre">'enabled'</span> <span class="pre">=&gt;</span> <span class="pre">1))</span></tt></li>
<li><tt class="docutils literal"><span class="pre">$type</span></tt> parameters get passed through <tt class="docutils literal"><span class="pre">DbHelper::generateColumnDefinition()</span></tt>, so you can pass in attribute configs</li>
<li><tt class="docutils literal"><span class="pre">createTable()</span></tt> automatically adds the audit columns: id, dateCreated, dateUpdated, and uid.</li>
</ul>
<p>We’ve also added the following methods to DbCommand:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">addSelect($columns</span> <span class="pre">=</span> <span class="pre">'*')</span></tt></dt>
<dd>Adds additional columns to the query, without overwriting the existing ones (unlike <tt class="docutils literal"><span class="pre">select()</span></tt>, which will clear any previously defined columns).</dd>
<dt><tt class="docutils literal"><span class="pre">addWhere($conditions,</span> <span class="pre">$params</span> <span class="pre">=</span> <span class="pre">array())</span></tt></dt>
<dd>Adds additional conditions to the query, without overwriting the existing ones (unlike <tt class="docutils literal"><span class="pre">where()</span></tt>, which will clear any previously defined conditions).</dd>
<dt><tt class="docutils literal"><span class="pre">insertAll($table,</span> <span class="pre">$columns,</span> <span class="pre">$vals)</span></tt></dt>
<dd>Batch-inserts multiple rows at once. <tt class="docutils literal"><span class="pre">$columns</span></tt> should be an array of column names, and <tt class="docutils literal"><span class="pre">$vals</span></tt> should be an array of row value arrays.</dd>
<dt><tt class="docutils literal"><span class="pre">addColumnFirst($table,</span> <span class="pre">$column,</span> <span class="pre">$type)</span></tt></dt>
<dd>Adds a new column to the beginning of a table.</dd>
<dt><tt class="docutils literal"><span class="pre">addColumnBefore($table,</span> <span class="pre">$column,</span> <span class="pre">$type,</span> <span class="pre">$before)</span></tt></dt>
<dd>Adds a new column before another one.</dd>
<dt><tt class="docutils literal"><span class="pre">addColumnAfter($table,</span> <span class="pre">$column,</span> <span class="pre">$type,</span> <span class="pre">$after)</span></tt></dt>
<dd>Adds a new column after another one.</dd>
</dl>
</div>
</div>



			
			<nav class="nav">
				Next up: <a href="records.html">Active Record Models</a></li>
			</nav>
			
		</div>
	</div>
</body>
</html>