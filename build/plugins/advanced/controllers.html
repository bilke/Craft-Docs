
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
	<meta charset="utf-8" />
	<title>Controllers - Blocks Docs</title>
	<link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
	<link rel="stylesheet" href="../../_static/css/docs.css" type="text/css" />
</head>

<body>
	<div class="sidebar">
		<div class="content">
			<h1>Blocks Docs</h1>

			<nav class="nav">
				<ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Blocks Docs Home</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installing and Updating</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">System Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../templating/index.html">Templating</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Plugin Development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../basics/gettingstarted.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/templates.html">Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/resources.html">Front-end Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/i18n.html">Internationalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../db/querybuilder.html">The Query Builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../db/records.html">Active Record Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../db/migrations.html">Migrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/widgets.html">Dashboard Widgets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/blocktypes.html">Block Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="models.html">Models</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Controllers</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="services.html">Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="variables.html">Template Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/account.html">AccountService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/blockTypes.html">BlockTypesService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/config.html">ConfigService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/email.html">EmailService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/entries.html">EntriesService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/globals.html">GlobalsService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/pages.html">PagesService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/path.html">PathService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/request.html">HttpRequestService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/i18n.html">LocalizationService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/plugins.html">PluginsService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/templates.html">TemplatesService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/users.html">UsersService</a></li>
</ul>
</li>
</ul>

			</nav>
		</div>
	</div>

	<div class="main">
		<div class="content">
			
				<ul class="crumbs">
					<li><a href="../index.html">Plugin Development</a></li>
				</ul>
			

			
  <div class="section" id="controllers">
<h1>Controllers<a class="headerlink" href="#controllers" title="Permalink to this headline">¶</a></h1>
<p>Generally speaking, controllers are the middlemen between the front end of the CP/website and your plugin’s <a class="reference internal" href="services.html"><em>services</em></a>. They contain <strong>action methods</strong> which handle individual tasks.</p>
<p>A common pattern used throughout Blocks involves a controller action gathering post data, saving it on a <a class="reference internal" href="models.html"><em>model</em></a>, passing the model off to a <a class="reference internal" href="services.html"><em>service</em></a>, and then responding to the request appropriately depending on the service method’s response.</p>
<p>Action methods begin with the prefix “action”, followed by a description of what the method does (for example, <tt class="docutils literal"><span class="pre">actionSaveIngredient()</span></tt>).</p>
<p>To create a controller, first create a new controllers/ subfolder within your plugin’s folder. Then create a new file in that folder, named with this format:</p>
<div class="highlight-python"><pre>[PluginHandle]_[ControllerName]Controller.php</pre>
</div>
<p>If your plugin name is “Cocktail Recipes”, and you’re writing a controller to handle ingredient actions, the file would be named “CocktailRecipes_IngredientsController.php”.</p>
<p>Create a new class in that file, with the same name as the filename:</p>
<div class="highlight-php"><pre>&lt;?php
namespace Blocks;

class “CocktailRecipes_IngredientsController extends BaseController
{
    public function actionSaveIngredient()
    {
        ...
    }

    public function actionDeleteIngredient()
    {
        ...
    }
}</pre>
</div>
<div class="section" id="accessing-controller-actions">
<h2>Accessing Controller Actions<a class="headerlink" href="#accessing-controller-actions" title="Permalink to this headline">¶</a></h2>
<p>There are two ways to access controller actions: <a class="reference internal" href="#action-urls"><em>Action URLs</em></a> and <a class="reference internal" href="#action-post-requests"><em>Action POST Requests</em></a>.</p>
<div class="section" id="action-urls">
<span id="id1"></span><h3>Action URLs<a class="headerlink" href="#action-urls" title="Permalink to this headline">¶</a></h3>
<p>Action URLs are URLs which begin with either “admin.php” or “index.php” (the entry point is not significant), followed by a URI that meets the following criteria:</p>
<ol class="arabic simple">
<li>The first segment matches the actionTrigger config setting (“actions” by default)</li>
<li>The second segment matches a plugin name (e.g. “cocktailRecipes”)</li>
<li>The third segment matches one of that plugin’s controller names (e.g. “ingredients”)</li>
<li>The fourth segment matches one of that controller’s actions (e.g. “saveIngredient”)</li>
</ol>
<p>To pull it all together, an action URL might look like: admin.php/actions/cocktailRecipes/ingredients/saveIngredient</p>
<p>In the off chance that a website actually has a section whose URIs should begin with “actions/”, we have made that first action URL segment configurable (via the actionTrigger config setting). But rather than require developers to check the actionTrigger value every time they need to output an action URL, we have provided a helper function, <tt class="docutils literal"><span class="pre">UrlHelper::getActionUrl('plugin/controller/action')</span></tt>, which accepts everything but that first actionTrigger segment, and returns the full action URL. A corresponding template function has also been provided, <tt class="docutils literal"><span class="pre">{{</span> <span class="pre">actionUrl('plugin/controller/action')</span> <span class="pre">}}</span></tt>:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;{{ actionUrl(&#39;cocktailRecipes/ingredients/saveIngredient&#39;) }}&quot;</span><span class="nt">&gt;</span>Save<span class="nt">&lt;/a&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="action-post-requests">
<span id="id2"></span><h3>Action POST Requests<a class="headerlink" href="#action-post-requests" title="Permalink to this headline">¶</a></h3>
<p>Alternatively, you can reach a controller action regardless of URL by passing a POST parameter with the request by the name of “action”. Its value should be identical to what you would pass into <tt class="docutils literal"><span class="pre">UrlHelper::getActionUrl()</span></tt> –&nbsp;“plugin/controller/action”:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name=</span><span class="s">&quot;action&quot;</span> <span class="na">value=</span><span class="s">&quot;cocktailRecipes/ingredients/saveIngredient&quot;</span><span class="nt">&gt;</span>
</pre></div>
</div>
<p>This is handy for form submission, where you want the original form to reload itself in the event of a validation error. In that case, you can leave the <tt class="docutils literal"><span class="pre">&lt;form&gt;</span></tt> tag’s <tt class="docutils literal"><span class="pre">action=&quot;&quot;</span></tt>, which will leave the current URL in-tact for the response, unless of course your controller action redirects the browser to a different URL.</p>
</div>
</div>
<div class="section" id="allowing-anonymous-access-to-actions">
<h2>Allowing Anonymous Access to Actions<a class="headerlink" href="#allowing-anonymous-access-to-actions" title="Permalink to this headline">¶</a></h2>
<p>By default, controller actions are only accessible to logged-in users. You can override that by changing the protected <tt class="docutils literal"><span class="pre">$allowAnonymous</span></tt> property on your controller class. To allow anonymous access to all of your controller’s actions, set it to <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">protected $allowAnonymous = true;</span>
</pre></div>
</div>
<p>Or if you only want to allow anonymous access to specific actions, you can set it to an array of those actions’ method names:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">protected $allowAnonymous = array(&#39;actionSaveIngredient&#39;);</span>
</pre></div>
</div>
</div>
<div class="section" id="basecontroller-methods">
<h2>BaseController Methods<a class="headerlink" href="#basecontroller-methods" title="Permalink to this headline">¶</a></h2>
<p>BaseController makes several methods available to your action methods:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">$this-&gt;requireLogin()</span></tt></dt>
<dd>Requires the user to be logged in. Useful if most of your actions should allow anonymous access, with a couple of exceptions. Set <tt class="docutils literal"><span class="pre">protected</span> <span class="pre">$allowAnonymous</span> <span class="pre">=</span> <span class="pre">true;</span></tt> and call <tt class="docutils literal"><span class="pre">$this-&gt;requireLogin()</span></tt> at the beginning of any action methods that should require login.</dd>
<dt><tt class="docutils literal"><span class="pre">$this-&gt;requireAdmin()</span></tt></dt>
<dd>Requires the user to be logged in with an Admin account.</dd>
<dt><tt class="docutils literal"><span class="pre">$this-&gt;requirePostRequest()</span></tt></dt>
<dd>Requires the current request to be sent over POST. We recommend you use this for all actions that change the system state in any way.</dd>
<dt><tt class="docutils literal"><span class="pre">$this-&gt;requireAjaxRequest()</span></tt></dt>
<dd>Requires the current request to be sent over AJAX.</dd>
<dt><tt class="docutils literal"><span class="pre">$this-&gt;redirect($url,</span> <span class="pre">$terminate</span> <span class="pre">=</span> <span class="pre">true,</span> <span class="pre">$statusCode</span> <span class="pre">=</span> <span class="pre">302)</span></tt></dt>
<dd>Redirects the request to a different URL. <tt class="docutils literal"><span class="pre">$url</span></tt> can be either an absolute URL or just a URI.</dd>
<dt><tt class="docutils literal"><span class="pre">$this-&gt;redirectToPostedUrl($variables</span> <span class="pre">=</span> <span class="pre">array())</span></tt></dt>
<dd>Redirects to the URL defined by the “redirect” POST parameter. If you pass any variables, they will be swapped out first. For example, <tt class="docutils literal"><span class="pre">$this-&gt;redirectToPostedUrl(array('drinkId'</span> <span class="pre">=&gt;</span> <span class="pre">$drink-&gt;id));</span></tt> would swap any instances of <tt class="docutils literal"><span class="pre">{drinkId}</span></tt> in the posted URL with <tt class="docutils literal"><span class="pre">$drink-&gt;id</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">$this-&gt;returnJson($var)</span></tt></dt>
<dd>JSON-encodes <tt class="docutils literal"><span class="pre">$var</span></tt> and responds with it, with the appropriate JSON headers.</dd>
<dt><tt class="docutils literal"><span class="pre">$this-&gt;returnErrorJson($error)</span></tt></dt>
<dd>Responds with JSON, where <tt class="docutils literal"><span class="pre">response.error</span></tt> is set to <tt class="docutils literal"><span class="pre">$error</span></tt>.</dd>
</dl>
</div>
</div>



			
			<nav class="nav">
				Next up: <a href="services.html">Services</a></li>
			</nav>
			
		</div>
	</div>
</body>
</html>