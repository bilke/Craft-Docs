
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
	<meta charset="utf-8" />
	<title>Controllers - Blocks Docs</title>
	<link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
	<link rel="stylesheet" href="../../_static/css/docs.css" type="text/css" />
</head>

<body>
	<div class="sidebar">
		<div class="content">
			<h1>Blocks Docs</h1>

			<nav class="nav">
				<ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Blocks Docs Home</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installing and Updating</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">System Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../templating/index.html">Templating</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Plugin Development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../basics/gettingstarted.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/templates.html">Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/resources.html">Front-end Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/i18n.html">Internationalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../db/querybuilder.html">The Query Builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../db/records.html">Active Record Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../db/migrations.html">Migrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/widgets.html">Dashboard Widgets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/blocktypes.html">Block Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="models.html">Models</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Controllers</a><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="services.html">Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="variables.html">Template Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/account.html">AccountService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/blockTypes.html">BlockTypesService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/config.html">ConfigService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/email.html">EmailService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/entries.html">EntriesService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/globals.html">GlobalsService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/pages.html">PagesService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/path.html">PathService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/request.html">HttpRequestService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/i18n.html">LocalizationService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/plugins.html">PluginsService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/templates.html">TemplatesService</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/users.html">UsersService</a></li>
</ul>
</li>
</ul>

			</nav>
		</div>
	</div>

	<div class="main">
		<div class="content">
			
				<ul class="crumbs">
					<li><a href="../index.html">Plugin Development</a></li>
				</ul>
			

			
  <div class="section" id="controllers">
<h1>Controllers<a class="headerlink" href="#controllers" title="Permalink to this headline">¶</a></h1>
<p>Generally speaking, controllers are the middlemen between the front end of the CP/website and your plugin’s <a class="reference internal" href="services.html"><em>services</em></a>. They contain <strong>action methods</strong> which handle individual tasks.</p>
<p>A common pattern used throughout Blocks involves a controller action gathering post data, saving it on a <a class="reference internal" href="models.html"><em>model</em></a>, passing the model off to a <a class="reference internal" href="services.html"><em>service</em></a>, and then responding to the request appropriately depending on the service method’s response.</p>
<p>Action methods begin with the prefix “action”, followed by a description of what the method does (for example, <tt class="docutils literal"><span class="pre">actionSaveIngredient()</span></tt>).</p>
<p>To create a controller, first create a new controllers/ subfolder within your plugin’s folder. Then create a new file in that folder, named with this format:</p>
<div class="highlight-python"><pre>[PluginHandle]_[ControllerName]Controller.php</pre>
</div>
<p>If your plugin name is “Cocktail Recipes”, and you’re writing a controller to handle ingredient actions, the file would be named “CocktailRecipes_IngredientsController.php”.</p>
<p>Create a new class in that file, with the same name as the filename:</p>
<div class="highlight-php"><pre>&lt;?php
namespace Blocks;

class “CocktailRecipes_IngredientsController extends BaseController
{
    public function actionSaveIngredient()
    {
        ...
    }

    public function actionDeleteIngredient()
    {
        ...
    }
}</pre>
</div>
<div class="section" id="accessing-controller-actions">
<h2>Accessing Controller Actions<a class="headerlink" href="#accessing-controller-actions" title="Permalink to this headline">¶</a></h2>
<p>Blocks will route an incoming request to a controller action if one of the following is true:</p>
<ul class="simple">
<li>The first segment of the URL is “actions/” (configurable via <tt class="docutils literal"><span class="pre">$blocksConfig['actionTrigger']</span></tt>), followed by an action path</li>
<li>There is an “action” param in the URL query string or POST data, set to an action path</li>
</ul>
<p>The “action path” tells Blocks which controller class and action method to call. In the context of plugins, they should look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">PluginHandle</span><span class="p">]</span><span class="o">/</span><span class="p">[</span><span class="n">ControllerName</span><span class="p">]</span><span class="o">/</span><span class="p">[</span><span class="n">ActionName</span><span class="p">]</span>
</pre></div>
</div>
<p>If your plugin class is “CocktailRecipesPlugin”, your controller class name is “CocktailRecipes_IngredientsController”, and your action method name is “actionSaveIngredient”, the action path would be “cocktailRecipes/ingredients/saveIngredient”.</p>
<p>To get the URL of an action, you can use <tt class="docutils literal"><span class="pre">UrlHelper::getActionUrl($actionPath)</span></tt>. We also provide a <tt class="docutils literal"><span class="pre">Blocks.getActionPath(actionPath)</span></tt> function for Javascript.</p>
</div>
<div class="section" id="allowing-anonymous-access-to-actions">
<h2>Allowing Anonymous Access to Actions<a class="headerlink" href="#allowing-anonymous-access-to-actions" title="Permalink to this headline">¶</a></h2>
<p>By default, controller actions are only accessible to logged-in users. You can override that by changing the protected <tt class="docutils literal"><span class="pre">$allowAnonymous</span></tt> property on your controller class. To allow anonymous access to all of your controller’s actions, set it to <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">protected $allowAnonymous = true;</span>
</pre></div>
</div>
<p>Or if you only want to allow anonymous access to specific actions, you can set it to an array of those actions’ method names:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">protected $allowAnonymous = array(&#39;actionSaveIngredient&#39;);</span>
</pre></div>
</div>
</div>
<div class="section" id="basecontroller-methods">
<h2>BaseController Methods<a class="headerlink" href="#basecontroller-methods" title="Permalink to this headline">¶</a></h2>
<p>BaseController makes several methods available to your action methods:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">$this-&gt;requireLogin()</span></tt></dt>
<dd>Requires the user to be logged in. Useful if most of your actions should allow anonymous access, with a couple of exceptions. Set <tt class="docutils literal"><span class="pre">protected</span> <span class="pre">$allowAnonymous</span> <span class="pre">=</span> <span class="pre">true;</span></tt> and call <tt class="docutils literal"><span class="pre">$this-&gt;requireLogin()</span></tt> at the beginning of any action methods that should require login.</dd>
<dt><tt class="docutils literal"><span class="pre">$this-&gt;requireAdmin()</span></tt></dt>
<dd>Requires the user to be logged in with an Admin account.</dd>
<dt><tt class="docutils literal"><span class="pre">$this-&gt;requirePostRequest()</span></tt></dt>
<dd>Requires the current request to be sent over POST. We recommend you use this for all actions that change the system state in any way.</dd>
<dt><tt class="docutils literal"><span class="pre">$this-&gt;requireAjaxRequest()</span></tt></dt>
<dd>Requires the current request to be sent over AJAX.</dd>
<dt><tt class="docutils literal"><span class="pre">$this-&gt;redirect($url,</span> <span class="pre">$terminate</span> <span class="pre">=</span> <span class="pre">true,</span> <span class="pre">$statusCode</span> <span class="pre">=</span> <span class="pre">302)</span></tt></dt>
<dd>Redirects the request to a different URL. <tt class="docutils literal"><span class="pre">$url</span></tt> can be either an absolute URL or just a URI.</dd>
<dt><tt class="docutils literal"><span class="pre">$this-&gt;redirectToPostedUrl($variables</span> <span class="pre">=</span> <span class="pre">array())</span></tt></dt>
<dd>Redirects to the URL defined by the “redirect” POST parameter. If you pass any variables, they will be swapped out first. For example, <tt class="docutils literal"><span class="pre">$this-&gt;redirectToPostedUrl(array('drinkId'</span> <span class="pre">=&gt;</span> <span class="pre">$drink-&gt;id));</span></tt> would swap any instances of <tt class="docutils literal"><span class="pre">{drinkId}</span></tt> in the posted URL with <tt class="docutils literal"><span class="pre">$drink-&gt;id</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">$this-&gt;returnJson($var)</span></tt></dt>
<dd>JSON-encodes <tt class="docutils literal"><span class="pre">$var</span></tt> and responds with it, with the appropriate JSON headers.</dd>
<dt><tt class="docutils literal"><span class="pre">$this-&gt;returnErrorJson($error)</span></tt></dt>
<dd>Responds with JSON, where <tt class="docutils literal"><span class="pre">response.error</span></tt> is set to <tt class="docutils literal"><span class="pre">$error</span></tt>.</dd>
</dl>
</div>
</div>



			
			<nav class="nav">
				Next up: <a href="services.html">Services</a></li>
			</nav>
			
		</div>
	</div>
</body>
</html>