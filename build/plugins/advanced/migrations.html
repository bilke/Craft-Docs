
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
	<meta charset="utf-8" />
	<title>Migrations - Blocks Docs</title>
	<link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
	<link rel="stylesheet" href="../../_static/css/docs.css" type="text/css" />
</head>

<body>
	<div class="sidebar">
		<div class="content">
			<h1>Blocks Docs</h1>

			<nav class="nav">
				<ul>
					<li class="toctree-l1">
						<a class="reference internal" href="../../index.html">Docs Home</a>
					</li>
				</ul>
				<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">System Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../templating/index.html">Templating</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Plugin Development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../basics/gettingstarted.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/templates.html">Templates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/resources.html">Front-end Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/queries.html">Querying the Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/i18n.html">Internationalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/widgets.html">Dashboard Widgets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../components/blocktypes.html">Block Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="models.html">Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="records.html">Active Record Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="controllers.html">Controllers</a></li>
<li class="toctree-l2"><a class="reference internal" href="services.html">Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="variables.html">Template Variables</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Migrations</a><ul class="simple">
</ul>
</li>
</ul>
</li>
</ul>

			</nav>
		</div>
	</div>

	<div class="main">
		<div class="content">
			
				<ul class="crumbs">
					<li><a href="../index.html">Plugin Development</a></li>
				</ul>
			

			
  <div class="section" id="migrations">
<h1>Migrations<a class="headerlink" href="#migrations" title="Permalink to this headline">¶</a></h1>
<p>If your schema changes over the life of your plugin, you can write a <strong>migration</strong> to keep existing installations updated with the latest schema.</p>
<p>Blocks comes with a handy shell script to get you started. To create a new migration, add a migrations/ subfolder to your plugin’s folder, open up Terminal, and run the following commands:</p>
<div class="highlight-python"><pre>cd /path/to/blocks/console
chmod 777 yiic
./yiic migrate create /path/to/YourPlugin/migrations/MigrationName</pre>
</div>
<p>That will create a new migration file in your migrations/ folder, which will look something like this:</p>
<p>Put your migration code in that <tt class="docutils literal"><span class="pre">safeUp()</span></tt> function.</p>
<p>In the event that you need to manually trigger a record’s table creation functions (i.e. when you add a new record class and need to update existing installs’ databases), you can use the <tt class="docutils literal"><span class="pre">createTable()</span></tt> and <tt class="docutils literal"><span class="pre">addForeignKeys()</span></tt> functions:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">$ingredientRecord = new CocktailRecipes_IngredientRecord();</span>
<span class="x">$drinkRecord = new CocktailRecipes_DrinkRecord();</span>

<span class="x">$ingredientRecord-&gt;createTable();</span>
<span class="x">$drinkRecord-&gt;createTable();</span>

<span class="x">$ingredientRecord-&gt;addForeignKeys();</span>
<span class="x">$drinkRecord-&gt;addForeignKeys();</span>
</pre></div>
</div>
<p>It’s important to call all of the <tt class="docutils literal"><span class="pre">createTable()</span></tt> methods before calling the <tt class="docutils literal"><span class="pre">addForeignKeys()</span></tt> methods so you can be sure that all of the tables are in place before trying to create foreign keys between the tables.</p>
<div class="section" id="running-the-migration">
<h2>Running the Migration<a class="headerlink" href="#running-the-migration" title="Permalink to this headline">¶</a></h2>
<p>Blocks automatically checks for new migrations whenever your version number changes, so as long as you remember to update your plugin’s version number, you don’t need to worry about getting the migration to actually run.</p>
</div>
</div>



			
		</div>
	</div>
</body>
</html>