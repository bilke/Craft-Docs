
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
	<meta charset="utf-8" />
	<title>Active Record Models - Blocks Docs</title>
	<link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
	<link rel="stylesheet" href="../../_static/css/docs.css" type="text/css" />
</head>

<body>
	<div class="sidebar">
		<div class="content">
			<h1>Blocks Docs</h1>

			<nav class="nav">
				<ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Blocks Docs Home</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installing and Updating</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">System Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../templating/index.html">Templating</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Plugin Development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../basics/index.html">The Basics</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Working with the Database</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="querybuilder.html">The Query Builder</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">Active Record Models</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="migrations.html">Migrations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/index.html">Adding New Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/index.html">Advanced Topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../apis/index.html">API Reference</a></li>
</ul>
</li>
</ul>

			</nav>
		</div>
	</div>

	<div class="main">
		<div class="content">
			
				<ul class="crumbs">
					<li><a href="../index.html">Plugin Development</a></li>
					<li><a href="index.html">Working with the Database</a></li>
				</ul>
			

			
  <div class="section" id="active-record-models">
<h1>Active Record Models<a class="headerlink" href="#active-record-models" title="Permalink to this headline">¶</a></h1>
<p>Active record models (or “records”) are like <a class="reference internal" href="../advanced/models.html"><em>models</em></a>, except with a database-facing layer built on top. On top of all the things that models can do, records can:</p>
<ul class="simple">
<li>Define database table schemas</li>
<li>Represent rows in the database</li>
<li>Find, alter, and delete rows</li>
</ul>
<p><strong>Note:</strong> Records’ ability to modify the database means that they should never be used to transport data throughout the system. Their instances should be contained to <a class="reference internal" href="../advanced/services.html"><em>services</em></a> only, so that services remain the one and only place where system state changes ever occur.</p>
<p>When a plugin is installed, Blocks will look for any records provided by the plugin, and automatically create the database tables for them.</p>
<p>To create a record, first create a new records/ subfolder within your plugin’s folder. Then create a new file in that folder, named with this format:</p>
<div class="highlight-python"><pre>[PluginHandle]_[RecordName]Record.php</pre>
</div>
<p>If your plugin name is “Cocktail Recipes”, and your record name is “Ingredient”, the file would be named “CocktailRecipes_IngredientRecord.php”.</p>
<p>Create a new class in that file, with the same name as the filename:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">Blocks</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CocktailRecipes_IngredientRecord</span> <span class="k">extends</span> <span class="nx">BaseRecord</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getTableName</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;cocktailrecipes_ingredients&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">defineAttributes</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nx">AttributeType</span><span class="o">::</span><span class="na">String</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="nx">AttributeType</span><span class="o">::</span><span class="na">Enum</span><span class="p">,</span> <span class="s1">&#39;values&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;alcohol,mixer,other&quot;</span><span class="p">),</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">getTableName()</span></tt> returns the name of the database table the model is associated with (sans table prefix). By convention, tables created by plugins should be prefixed with the plugin name and an underscore.</p>
<p><tt class="docutils literal"><span class="pre">defineAttributes()</span></tt> returns an array of attributse which map back to columns in the database table.</p>
<div class="section" id="defining-relations">
<h2>Defining Relations<a class="headerlink" href="#defining-relations" title="Permalink to this headline">¶</a></h2>
<p>If your record should have any relationships with other tables, you can specify them with the <tt class="docutils literal"><span class="pre">defineRelations()</span></tt> function:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">Blocks</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CocktailRecipes_IngredientRecord</span> <span class="k">extends</span> <span class="nx">BaseBlockType</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">defineRelations</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">&#39;drinks&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="k">static</span><span class="o">::</span><span class="na">HAS_MANY</span><span class="p">,</span> <span class="s1">&#39;CocktailRecipes_DrinkRecord&#39;</span><span class="p">,</span> <span class="s1">&#39;ingredientId&#39;</span><span class="p">),</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">defineRelations()</span></tt> works basically the same as <a class="reference external" href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a>’s <a class="reference external" href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord#relations-detail">relations()</a> method (see <a class="reference external" href="http://www.yiiframework.com/doc/guide/1.1/en/database.arr">Relational Active Record</a> from the Yii docs), with two differences:</p>
<ul class="simple">
<li>You don’t need to specify the namespace of the related record class in the second argument (defaults to the Blocks namespace)</li>
<li>You don’t need to specify the foreign key column name in BELONGS_TO relations (defaults to the relation name appended with “Id”)</li>
</ul>
</div>
<div class="section" id="defining-indexes">
<h2>Defining Indexes<a class="headerlink" href="#defining-indexes" title="Permalink to this headline">¶</a></h2>
<p>If you want to define any indexes on your table, you can do it with the <tt class="docutils literal"><span class="pre">defineIndexes()</span></tt> function:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">Blocks</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CocktailRecipes_IngredientRecord</span> <span class="k">extends</span> <span class="nx">BaseBlockType</span>
<span class="p">{</span>
    <span class="c1">// ...</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">defineIndexes</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">&#39;columns&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">),</span> <span class="s1">&#39;unique&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">),</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="further-reading">
<h2>Further Reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h2>
<p>BaseRecord is an instance of Yii’s <a class="reference external" href="http://www.yiiframework.com/doc/api/1.1/CActiveRecord">CActiveRecord</a> class, so everything CActiveRecord can do, BaseRecord can do as well.</p>
</div>
</div>



			
			<nav class="nav">
				Next up: <a href="migrations.html">Migrations</a></li>
			</nav>
			
		</div>
	</div>
</body>
</html>